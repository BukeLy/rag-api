#!/bin/bash

echo ""
echo "========================================================================"
echo "ğŸ” æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•"
echo "========================================================================"

# æŸ¥è¯¢ 1: naive æ¨¡å¼
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š æŸ¥è¯¢ 1: RAG API æœ‰å“ªäº›æ ¸å¿ƒåŠŸèƒ½ï¼Ÿï¼ˆnaive æ¨¡å¼ï¼‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

query1_start=$(date +%s)
query1_response=$(curl -s -X POST 'http://localhost:8000/query' \
  -H 'Content-Type: application/json' \
  -d '{"query": "RAG API æœ‰å“ªäº›æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ", "mode": "naive"}')
query1_end=$(date +%s)
query1_time=$((query1_end - query1_start))

answer1=$(echo "$query1_response" | jq -r '.answer')
echo "ç­”æ¡ˆï¼ˆå‰ 300 å­—ç¬¦ï¼‰:"
echo "$answer1" | head -c 300
echo "..."
echo ""
echo "â±ï¸  æŸ¥è¯¢è€—æ—¶: ${query1_time}s"

# æŸ¥è¯¢ 2: local æ¨¡å¼
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š æŸ¥è¯¢ 2: ç³»ç»Ÿæ”¯æŒå“ªäº›è§£æå™¨ï¼Ÿï¼ˆlocal æ¨¡å¼ï¼‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

query2_start=$(date +%s)
query2_response=$(curl -s -X POST 'http://localhost:8000/query' \
  -H 'Content-Type: application/json' \
  -d '{"query": "ç³»ç»Ÿæ”¯æŒå“ªäº›è§£æå™¨ï¼Ÿ", "mode": "local"}')
query2_end=$(date +%s)
query2_time=$((query2_end - query2_start))

answer2=$(echo "$query2_response" | jq -r '.answer')
echo "ç­”æ¡ˆï¼ˆå‰ 300 å­—ç¬¦ï¼‰:"
echo "$answer2" | head -c 300
echo "..."
echo ""
echo "â±ï¸  æŸ¥è¯¢è€—æ—¶: ${query2_time}s"

# æŸ¥è¯¢ 3: mix æ¨¡å¼
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š æŸ¥è¯¢ 3: RAG API çš„æŠ€æœ¯ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆmix æ¨¡å¼ï¼‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

query3_start=$(date +%s)
query3_response=$(curl -s -X POST 'http://localhost:8000/query' \
  -H 'Content-Type: application/json' \
  -d '{"query": "RAG API çš„æŠ€æœ¯ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ", "mode": "mix"}')
query3_end=$(date +%s)
query3_time=$((query3_end - query3_start))

answer3=$(echo "$query3_response" | jq -r '.answer')
echo "ç­”æ¡ˆï¼ˆå‰ 300 å­—ç¬¦ï¼‰:"
echo "$answer3" | head -c 300
echo "..."
echo ""
echo "â±ï¸  æŸ¥è¯¢è€—æ—¶: ${query3_time}s"

# æ€»ç»“
echo ""
echo "========================================================================"
echo "âœ… æŸ¥è¯¢æµ‹è¯•å®Œæˆï¼"
echo "========================================================================"
echo ""
echo "ğŸ“Š æŸ¥è¯¢æ€§èƒ½æ€»ç»“:"
echo "  - naive æ¨¡å¼: ${query1_time}s"
echo "  - local æ¨¡å¼: ${query2_time}s"
echo "  - mix æ¨¡å¼:   ${query3_time}s"
echo ""
echo "========================================================================"
